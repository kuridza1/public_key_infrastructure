<!-- Tab buttons (no Material tabs) -->
<div class="certificate-section">
<div class="tab-toggle" role="tablist" aria-label="Certificate actions">
  <button
    type="button"
    class="tab-btn"
    [class.active]="activeTab === 'csr'"
    role="tab"
    [attr.aria-selected]="activeTab === 'csr'"
    (click)="setActive('csr')">
    Upload Certificate Signing Request 
  </button>

  <button
    type="button"
    class="tab-btn"
    [class.active]="activeTab === 'gen'"
    role="tab"
    [attr.aria-selected]="activeTab === 'csr'"
    (click)="setActive('gen')">
    Generate Request
  </button>
</div>

<!-- Content: Upload CSR -->
 <div class="certificate-form-section">

<section *ngIf="activeTab === 'csr'" class="tab-content" role="tabpanel" aria-labelledby="Upload CSR">
  <form class="certificate-form" #csrForm="ngForm" (ngSubmit)="onSubmitCSR(csrForm)">
    <div class="row">
      <mat-form-field appearance="outline">
        <mat-label>CA Issuer</mat-label>
        <mat-select [(ngModel)]="signingOrganization" name="signingOrganization" required (selectionChange)="revalidateDates()">
          <mat-option *ngFor="let ca of caUsers" [value]="ca">{{ ca.organization }}</mat-option>
        </mat-select>
      </mat-form-field>
    </div>

    <div class="row">
      <div
        class="upload-container"
        (click)="fileInput.click()"
        (drop)="onDrop($event)"
        (dragover)="onDragOver($event)"
        (dragleave)="onDragLeave($event)"
        tabindex="0"
        role="button">
        <div class="upload-box" [class.dragging]="isDragging">
          <span class="material-symbols-rounded larger-icon">upload</span>

          <p>Drag 'n' drop CSR here, or click to select the file.</p>
          <div *ngIf="fileName" class="selected-file">
            <p class="file-name">Selected: {{ fileName }}</p>
            <button mat-icon-button type="button" (click)="removeFile($event)">
              <span class="material-symbols-rounded">close</span>
            </button>
          </div>
          <p class="hint" *ngIf="!fileName">Supported: .csr, .pem</p>
        </div>

        <input type="file" #fileInput accept=".csr,.pem" hidden (change)="onFileChosen($event)" name="csrFile" required>
      </div>
    </div>

    <div class="row">
      <mat-form-field appearance="outline">
        <mat-label>Not After</mat-label>
        <input matInput [matDatepicker]="pickerNotAfterCSR" [(ngModel)]="dateNotAfter" name="notAfterCSR"
               #notAfterCSRModel="ngModel" (ngModelChange)="revalidateDates()">
        <mat-datepicker-toggle matSuffix [for]="pickerNotAfterCSR"></mat-datepicker-toggle>
        <mat-datepicker #pickerNotAfterCSR></mat-datepicker>
      </mat-form-field>
    </div>

    <div class="actions">
      <button class="blue-button medium-btn" type="submit" [disabled]="csrForm.invalid || !csrFile || loading">
        Request
      </button>
    </div>
  </form>
</section>

<!-- Content: Generate Request -->
<section *ngIf="activeTab === 'gen'" class="tab-content" role="tabpanel" aria-labelledby="Generate Request">
  <form class="certificate-form" #requestForm="ngForm" (ngSubmit)="onSubmit(requestForm)">
    <div class="row">
      <mat-form-field appearance="outline">
        <mat-label>CA Issuer</mat-label>
        <mat-select [(ngModel)]="signingOrganization" name="signingOrganization" required (selectionChange)="revalidateDates()">
          <mat-option *ngFor="let ca of caUsers" [value]="ca">{{ ca.organization }}</mat-option>
        </mat-select>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Common Name (CN)</mat-label>
        <input matInput [(ngModel)]="commonName" name="commonName" required/>
      </mat-form-field>
    </div>

    <div class="row">
      <mat-form-field appearance="outline">
        <mat-label>Organization (O)</mat-label>
        <input matInput [(ngModel)]="organization" name="organization" required/>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Organizational Unit (OU)</mat-label>
        <input matInput [(ngModel)]="organizationalUnit" name="organizationalUnit" required/>
      </mat-form-field>
    </div>

    <div class="row">
      <mat-form-field appearance="outline">
        <mat-label>Email Address (E)</mat-label>
        <input matInput type="email" [(ngModel)]="email" name="email" required/>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Country (C)</mat-label>
        <input matInput maxlength="2" [(ngModel)]="country" name="country" (input)="onCountryInput($event)" required/>
      </mat-form-field>
    </div>

    <div class="row">
      <mat-form-field appearance="outline">
        <mat-label>Not Before</mat-label>
        <input matInput [matDatepicker]="pickerNotBefore" [(ngModel)]="dateNotBefore" name="notBefore"
               #notBeforeModel="ngModel" (ngModelChange)="revalidateDates()">
        <mat-datepicker-toggle matSuffix [for]="pickerNotBefore"></mat-datepicker-toggle>
        <mat-datepicker #pickerNotBefore></mat-datepicker>
      </mat-form-field>

      <mat-form-field appearance="outline">
        <mat-label>Not After</mat-label>
        <input matInput [matDatepicker]="pickerNotAfter" [(ngModel)]="dateNotAfter" name="notAfter"
               #notAfterModel="ngModel" (ngModelChange)="revalidateDates()">
        <mat-datepicker-toggle matSuffix [for]="pickerNotAfter"></mat-datepicker-toggle>
        <mat-datepicker #pickerNotAfter></mat-datepicker>
      </mat-form-field>
    </div>


    <!-- (extensions UI unchanged) -->
    <!-- ... your extensions container here ... -->

    <div class="actions">
      <button class="blue-button large-btn" type="button" (click)="addExtension()">
        Add extension
      </button>
      <button class="blue-button large-btn" type="submit" [disabled]="requestForm.invalid || loading">
        Request
      </button>
    </div>
  </form>
</section>
 </div>

 </div>


<!-- Existing loading overlay stays as-is -->
<div *ngIf="loading" class="loading-overlay">
  <mat-spinner></mat-spinner>
</div>

